---
title: "HW5 ebw2145"
output: html_document
date: "2025-11-14"
---
Packages 
```{r}
library(ggplot2)
library(dplyr)
library(broom)
library(tidyverse)
```
Problem 1
```{r}
all_bdays = seq(as.Date("2001-01-01"), as.Date("2001-12-31"), by = "day")
names(all_bdays) = 1:365

duplicate_bday = function(n) {
  bday_nums = sample(1:365, n, replace = TRUE)   
  bdays = all_bdays[as.character(bday_nums)]  
  any(duplicated(bdays))}

#randomly drawing bdays
set.seed(1)
group_sizes = 2:50
nsim = 10000

probabilities = sapply(group_sizes, function(n) {
  mean(replicate(nsim, duplicate_bday(n)))})

bday_df = data.frame(
  group_size = group_sizes,
  prob = probabilities)

bday_prob_plot = ggplot(bday_df, aes(x = group_size, y = prob)) +
  geom_line(linewidth = 1.2) +
  labs(title = "Duplicate Bday Simulation Simulation",
       x = "Group Size (n)",
       y = "Probability of Shared Birthday") +
  theme_minimal()

bday_prob_plot
```
The chance of two people having the same birthday is quite low (nearly 0, at 0.0024) and increases as there are more people in the group - for example, we see that the probability of two people having the same birthday is almost guaranteed at 0.9720. 

Problem 2
```{r}
set.seed(1)

sim_sample = function(n = 30, mu = 0, sigma = 5) 
  {x = rnorm(n, mean = mu, sd = sigma)
  ttest = t.test(x, mu = 0)
  tidy(ttest) %>% 
    select(estimate, p.value) %>% 
    rename(mu_hat = estimate, p_value = p.value)}

n = 30
sigma = 5
mus = 0:6
nsim = 5000

sim_grid = expand_grid(true_mu = mus,
  iter = 1:nsim)

sim_results = sim_grid %>%
  mutate(sim_out = map(true_mu, ~sim_sample(n = n, mu = .x, sigma = sigma)))%>%
  unnest(sim_out)

power_df = sim_results %>%
  group_by(true_mu) %>%
  summarize(power = mean(p_value < 0.05))

power_plot = ggplot(power_df, aes(x = true_mu, y = power)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  labs(title = "Power of One-Sample t-test vs True μ",
    x = "True Mean (μ)",
    y = "P Value") +
  theme_minimal()

power_plot

mean_df <- sim_results %>%
  group_by(true_mu) %>%
  summarize(mean_mu_hat = mean(mu_hat),
    mean_mu_hat_reject = mean(mu_hat[p_value < 0.05]))

mean_plot = ggplot(mean_df, aes(x = true_mu)) +
  geom_line(aes(y = mean_mu_hat, color = "All Samples"), size = 1.2) +
  geom_point(aes(y = mean_mu_hat, color = "All Samples"), size = 3) +
  geom_line(aes(y = mean_mu_hat_reject, color = "Rejected Samples"), size = 1.2) +
  geom_point(aes(y = mean_mu_hat_reject, color = "Rejected Samples"), size = 3) +
  scale_color_manual(values = c("All Samples" = "blue", "Rejected Samples" = "red"),
  name = "Sample Type") +
  labs(title = "Average Estimate of μ̂ vs True μ",
    x = "True Mean (μ)",
    y = "Average μ̂") +
  theme_minimal()
mean_plot
```
This simulation shows that the average of mu vs true mu across only significant tests is typically higher than the true mu for small or moderate effects due; as mu approaches the true mu the effect size and power increases. 

Problem 3
```{r}
homicides = read.csv("homicide-data.csv")
glimpse(homicides)
summary(homicides)

city_summary = homicides %>%
  mutate(city_state = str_c(city, state, sep = ", ")) %>%
  group_by(city_state) %>%
  summarize(total_homicides = n(),
    unsolved_homicides = sum(disposition %in% c("Closed without arrest", "Open/No arrest")), .groups = "drop")

baltimore_homicide = city_summary %>% 
  filter(city_state == "Baltimore, MD")

baltimore_prop_test = prop.test(x = baltimore_homicide$unsolved_homicides,
  n = baltimore_homicide$total_homicides)

# Tidy the output
baltimore_tidy = tidy(baltimore_prop_test) %>%
  select(estimate, conf.low, conf.high)

baltimore_tidy

all_city = city_summary %>%
  mutate(prop_test = map2(unsolved_homicides, total_homicides, ~ prop.test(.x, .y)),
    prop_tidy = map(prop_test, tidy)) %>%
  unnest(prop_tidy) %>%
  select(city_state, estimate, conf.low, conf.high)

all_city = all_city %>%
  arrange(desc(estimate)) %>%
  mutate(city_state = factor(city_state, levels = city_state)) 

all_city_plot = all_city %>%
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point(color = "blue") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.3, color = "red") +
  coord_flip() +
  labs(title = "Proportion of Unsolved Homicides by City",
    x = "City, State",
    y = "Proportion Unsolved") +
  theme_minimal()

all_city_plot
```